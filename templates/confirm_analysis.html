{% extends 'base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto py-8 px-4">

  <div class="bg-white rounded-2xl shadow-lg mb-8 p-6 border border-gray-200">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2 flex items-center gap-3">
      <span class="text-3xl">üìä</span>
      <span>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–ª–∞</span>
    </h1>
    {% if error %}
      <p class="text-gray-600">–ú—ã –Ω–µ —Å–º–æ–≥–ª–∏ –∏–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>
    {% else %}
      <p class="text-gray-600">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ —Ü–µ–ª–∏ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.</p>
    {% endif %}
  </div>

  {% if error %}
    <div class="bg-yellow-50 border-l-4 border-yellow-500 rounded p-5 mb-8 text-yellow-800">
      <h2 class="font-semibold mb-1">‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö</h2>
      <p class="text-sm leading-relaxed">{{ error }}</p>
    </div>
    <div class="bg-white rounded-xl shadow p-6">
      <a href="/profile" class="inline-block text-blue-600 hover:text-blue-700 hover:underline">
        ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å
      </a>
    </div>

  {% elif data %}
    <form method="POST" action="/confirm_analysis" class="space-y-8">

      {% set labels = {
        "height": ("–†–æ—Å—Ç", "—Å–º", "üìè"),
        "weight": ("–í–µ—Å", "–∫–≥", "‚öñÔ∏è"),
        "bmi": ("–ò–ú–¢", "", "üìê"),
        "fat_mass": ("–ñ–∏—Ä–æ–≤–∞—è –º–∞—Å—Å–∞", "–∫–≥", "üßà"),
        "muscle_mass": ("–ú—ã—à–µ—á–Ω–∞—è –º–∞—Å—Å–∞", "–∫–≥", "üí™"),
        "body_age": ("–í–æ–∑—Ä–∞—Å—Ç —Ç–µ–ª–∞", "–ª–µ—Ç", "üß¨"),
        "metabolism": ("–ë–∞–∑–æ–≤—ã–π –æ–±–º–µ–Ω", "–∫–∫–∞–ª", "‚ö°")
      } %}

      <section class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
        <h3 class="text-xl font-semibold text-gray-800 mb-5">–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ —Ü–µ–ª–∏</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

          <div class="bg-gray-50/70 border rounded-lg p-4">
            <div class="text-sm text-gray-500 mb-1">{{ labels.weight[2] }} {{ labels.weight[0] }}</div>
            <div class="text-2xl font-bold text-gray-800">
              {{ data.weight }} <span class="text-lg text-gray-500">{{ labels.weight[1] }}</span>
            </div>
          </div>

          <div class="bg-gray-50/70 border rounded-lg p-4">
            <label for="height" class="text-sm text-gray-500 mb-1 block">{{ labels.height[2] }} {{ labels.height[0] }}</label>
            <input type="number" name="height" id="height" value="{{ data.height }}"
                   class="w-full bg-white border-gray-300 text-2xl font-bold text-gray-800 rounded px-3 py-1 border shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>

          <div class="bg-green-50 border border-green-200 rounded-lg p-4">
            <div class="text-sm font-medium text-green-800 mb-2">{{ labels.muscle_mass[2] }} {{ labels.muscle_mass[0] }}</div>
            <div class="flex items-end gap-4">
              <div>
                <div class="text-xs text-gray-500">–¢–µ–∫—É—â–∞—è</div>
                <div class="text-2xl font-bold text-green-900">{{ data.muscle_mass }} <span class="text-lg">{{ labels.muscle_mass[1] }}</span></div>
              </div>
              <div class="text-2xl text-gray-400 pb-1">‚Üí</div>
              <div class="flex-1">
                <label for="muscle_mass_goal" class="text-xs text-gray-500">–¶–µ–ª—å</label>
                <input type="number" step="0.1" name="muscle_mass_goal" id="muscle_mass_goal" value="{{ data.muscle_mass_goal }}"
                       class="w-full bg-white border-gray-300 font-semibold text-gray-800 rounded px-2 py-1 border shadow-sm focus:outline-none focus:ring-1 focus:ring-green-500">
              </div>
            </div>
            {% set muscle_diff = data.muscle_mass_goal - data.muscle_mass %}
            {% if muscle_diff > 0 %}
              <div class="text-xs text-green-700 mt-2 font-medium">–ù—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å: {{ muscle_diff|round(1) }} –∫–≥</div>
            {% endif %}
          </div>

          <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
            <div class="text-sm font-medium text-orange-800 mb-2">{{ labels.fat_mass[2] }} {{ labels.fat_mass[0] }}</div>
            <div class="flex items-end gap-4">
              <div>
                <div class="text-xs text-gray-500">–¢–µ–∫—É—â–∞—è</div>
                <div class="text-2xl font-bold text-orange-900">{{ data.fat_mass }} <span class="text-lg">{{ labels.fat_mass[1] }}</span></div>
              </div>
              <div class="text-2xl text-gray-400 pb-1">‚Üí</div>
              <div class="flex-1">
                <label for="fat_mass_goal" class="text-xs text-gray-500">–¶–µ–ª—å</label>
                <input type="number" step="0.1" name="fat_mass_goal" id="fat_mass_goal" value="{{ data.fat_mass_goal }}"
                       class="w-full bg-white border-gray-300 font-semibold text-gray-800 rounded px-2 py-1 border shadow-sm focus:outline-none focus:ring-1 focus:ring-orange-500">
              </div>
            </div>
            {% set fat_diff = data.fat_mass - data.fat_mass_goal %}
            {% if fat_diff > 0 %}
              <div class="text-xs text-orange-700 mt-2 font-medium">–ù—É–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å: {{ fat_diff|round(1) }} –∫–≥</div>
            {% endif %}
          </div>

        </div>
      </section>

      <section class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
          <h3 class="text-xl font-semibold text-gray-800 mb-4">–ü—Ä–æ—á–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {% for key in ['bmi', 'body_age', 'metabolism'] %}
              {% if data.get(key) is not none %}
                  {% set label, unit, icon = labels[key] %}
                  <div class="bg-gray-50/70 border rounded-lg p-4">
                    <div class="text-sm text-gray-500">{{ icon }} {{ label }}</div>
                    <div class="text-lg font-bold text-gray-800 mt-1">
                      {{ data[key] }}{% if unit %} {{ unit }}{% endif %}
                    </div>
                  </div>
              {% endif %}
            {% endfor %}
          </div>
      </section>

      <div class="flex flex-col sm:flex-row sm:justify-end gap-4 pt-4">
        <a href="/profile"
           class="sm:w-auto w-full text-center px-6 py-3 rounded-lg border border-gray-300 text-gray-700 bg-white hover:bg-gray-100 transition font-semibold">
          –û—Ç–º–µ–Ω–∏—Ç—å
        </a>
        <button type="submit"
                class="sm:w-auto w-full px-6 py-3 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition shadow-lg shadow-blue-500/20 hover:shadow-xl hover:shadow-blue-500/30">
          ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ü–µ–ª–∏
        </button>
      </div>

    </form>
  {% endif %}

</div>
{% endblock %}