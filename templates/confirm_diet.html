{% extends 'base.html' %}
{% block content %}

<style>
  /* Styles for the flip cards */
  .flip-card {
    perspective: 1200px;
    transition: transform .4s ease;
  }
  .flip-card:hover {
    transform: scale(1.03);
  }
  .flip-inner {
    transition: transform 1s ease;
    transform-style: preserve-3d;
    position: relative;
    width: 100%;
    height: 100%;
  }
  .flipped .flip-inner {
    transform: rotateY(180deg);
  }
  .flip-front, .flip-back {
    backface-visibility: hidden;
    position: absolute;
    inset: 0;
    padding: 1.5rem;
    border-radius: 1.25rem;
    box-shadow: 0 12px 25px rgba(0,0,0,.2);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .flip-back {
    transform: rotateY(180deg);
    overflow-y: auto;
  }
  /* Style for the interactive arrow icon */
  .click-arrow {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    font-size: 1.4rem;
    transform: rotate(-45deg);
    transition: .3s ease;
    color: rgba(255,255,255,.5);
  }
  .flip-card:hover .click-arrow {
    transform: rotate(-45deg) translate(5px,-5px) scale(1.2);
    color: #fff;
  }
  .flip-back .click-arrow {
    color: #444;
  }
  .flip-card:hover .flip-back .click-arrow {
    color: #000;
  }
</style>

<div class="container mx-auto px-4 py-10">

  <!-- Header with title and new shopping cart button -->
  <div class="flex justify-between items-center mb-14">
    <div class="flex-1"></div> <!-- Spacer for centering the title -->
    <h1 class="text-4xl font-extrabold text-center text-black tracking-wide flex-2">üç± –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –î–∏–µ—Ç–∞</h1>
    <div class="flex-1 flex justify-end">
    <a href="{{ url_for('shopping_bp.shopping_cart_page', diet_id=diet.id) }}" class="flex items-center gap-2 bg-white hover:bg-red-50 text-red-600 font-semibold px-4 py-2 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 108 30" stroke="currentColor"><path fill="#F32213" d="M.01 30h107.98V0H.01v30Z"/><path fill="#fff" d="m57.14 16.52.34-1.63h-5.46l-2.45 11.58h5.62l.46-2.18h3.33l.49 2.18h5.61L65.1 14.89h-5.45l-2.51 1.63Zm-2.3 5.42.8-3.82.8 3.82h-1.6Zm18.91-5.42-3.1 11.58h5.61l3.11-11.58h-5.62Zm8.55 11.58h5.62V14.89h-5.62v11.58Zm13.52 0h5.62l-2.4-8.8-2.38 8.8Zm-51.5-11.58-3.1 11.58h5.61l3.11-11.58h-5.62Zm8.55 11.58h5.62V14.89h-5.62v11.58Zm13.52 0h5.62l-2.4-8.8-2.38 8.8Zm-33.19-2.2 1.34-6.32 3.1 11.58h5.62L34.1 14.89h-5.62l-5.06 9.4-.3-1.42-1.34-6.32h-5.62l3.1 11.58h5.45l2.1-3.92Z"/></svg>
        <span>–°–æ–∑–¥–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É</span>
    </a>
</div>
  </div>

  {% set meals = {
    '–ó–∞–≤—Ç—Ä–∞–∫': {'items': breakfast, 'color': 'bg-gradient-to-br from-amber-300 to-amber-500'},
    '–û–±–µ–¥': {'items': lunch, 'color': 'bg-gradient-to-br from-orange-300 to-orange-500'},
    '–£–∂–∏–Ω': {'items': dinner, 'color': 'bg-gradient-to-br from-purple-300 to-purple-500'}
  } %}

  <!-- Main meal cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
    {% for meal_name, meal in meals.items() %}
      <div class="flip-card h-[420px] cursor-pointer w-[90%] mx-auto" onclick="this.classList.toggle('flipped')">
        <div class="flip-inner rounded-2xl">
          <!-- FRONT SIDE -->
          <div class="flip-front {{ meal.color }} text-gray-900 relative overflow-hidden">
            <div>
              <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold mb-5 tracking-wide">{{ meal_name }}</h2>
                <span class="text-xs opacity-70">{{ (meal['items']|length) }} –±–ª—é–¥(–∞)</span>
              </div>
              <ul class="space-y-3 text-sm leading-relaxed">
                {% for food in meal['items'] %}
                  <li class="bg-white bg-opacity-40 rounded-lg px-3 py-2 shadow-sm">
                    <p class="font-semibold">{{ food.name }}</p>
                    <div class="flex flex-wrap gap-2 mt-1">
                      <span class="inline-block bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full">{{ food.kcal }} –∫–∫–∞–ª</span>
                      <span class="inline-block bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full">{{ food.grams }} –≥</span>
                    </div>
                  </li>
                {% endfor %}
              </ul>
            </div>
            <div class="click-arrow">‚ûú</div>
          </div>
          <!-- BACK SIDE (Recipes) -->
          <div class="flip-back bg-white text-gray-800">
            <div>
              <h3 class="text-2xl font-bold mb-4">{{ meal_name }} ‚Äî –†–µ—Ü–µ–ø—Ç—ã</h3>
              <div class="space-y-4 text-sm leading-relaxed max-h-60 overflow-y-auto pr-2">
                {% for food in meal['items'] %}
                  <div>
                    <p class="font-semibold">{{ food.name }}</p>
                    <p class="whitespace-pre-line text-gray-600">{{ food.recipe }}</p>
                  </div>
                {% endfor %}
              </div>
            </div>
            <div class="click-arrow">‚ûú</div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Snack Card -->
  {% if snack|default([]) %}
    <div class="flex justify-center mt-12">
      <div class="flip-card h-[420px] cursor-pointer w-[90%] md:w-1/3" onclick="this.classList.toggle('flipped')">
        <div class="flip-inner rounded-2xl">
          <!-- FRONT SIDE -->
          <div class="flip-front bg-gradient-to-br from-lime-200 to-lime-400 text-gray-900 relative overflow-hidden">
            <div class="flex items-center justify-between">
              <h2 class="text-2xl font-bold mb-5 tracking-wide">–ü–µ—Ä–µ–∫—É—Å</h2>
              <span class="text-xs opacity-70">{{ (snack|default([]))|length }} –±–ª—é–¥(–∞)</span>
            </div>
            <ul class="space-y-3 text-sm leading-relaxed">
              {% for food in (snack|default([])) %}
                <li class="bg-white bg-opacity-40 rounded-lg px-3 py-2 shadow-sm">
                  <p class="font-semibold">{{ food.name }}</p>
                  <div class="flex flex-wrap gap-2 mt-1">
                    <span class="inline-block bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full">{{ food.kcal }} –∫–∫–∞–ª</span>
                    <span class="inline-block bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full">{{ food.grams }} –≥</span>
                  </div>
                </li>
              {% endfor %}
            </ul>
            <div class="click-arrow">‚ûú</div>
          </div>
          <!-- BACK SIDE (Recipes for snack) -->
          <div class="flip-back bg-white text-gray-800">
             <div>
              <h3 class="text-2xl font-bold mb-4">–ü–µ—Ä–µ–∫—É—Å ‚Äî –†–µ—Ü–µ–ø—Ç—ã</h3>
              <div class="space-y-4 text-sm leading-relaxed max-h-60 overflow-y-auto pr-2">
                {% for food in (snack|default([])) %}
                  <div>
                    <p class="font-semibold">{{ food.name }}</p>
                    <p class="whitespace-pre-line text-gray-600">{{ food.recipe }}</p>
                  </div>
                {% endfor %}
              </div>
            </div>
            <div class="click-arrow">‚ûú</div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Daily Totals -->
  <div class="mt-16 bg-white p-6 rounded-xl text-center shadow-xl">
    <h2 class="text-2xl font-bold mb-4">–°—É—Ç–æ—á–Ω—ã–π –∏—Ç–æ–≥</h2>
    <div class="flex flex-wrap justify-center gap-8 text-lg font-medium text-gray-700">
      <div><p class="text-gray-500">–ö–∞–ª–æ—Ä–∏–∏</p><p class="text-2xl text-green-600 font-bold">{{ diet.total_kcal }} –∫–∫–∞–ª</p></div>
      <div><p class="text-gray-500">–ë–µ–ª–∫–∏</p><p class="text-2xl text-blue-600 font-bold">{{ diet.protein }} –≥</p></div>
      <div><p class="text-gray-500">–ñ–∏—Ä—ã</p><p class="text-2xl text-yellow-600 font-bold">{{ diet.fat }} –≥</p></div>
      <div><p class="text-gray-500">–£–≥–ª–µ–≤–æ–¥—ã</p><p class="text-2xl text-pink-600 font-bold">{{ diet.carbs }} –≥</p></div>
    </div>
  </div>

</div>
{% endblock %}
