{% extends "base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto px-4 py-10 space-y-10">

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div class="flex justify-between items-center">
    <h1 class="text-2xl font-bold text-gray-800">üìñ –ò—Å—Ç–æ—Ä–∏—è –¥–∏–µ—Ç</h1>
    <a href="/profile" class="text-blue-600 text-sm hover:underline">‚Üê –ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å</a>
  </div>

  <!-- –ì—Ä–∞—Ñ–∏–∫ –∫–∞–ª–æ—Ä–∏–π -->
  <div class="bg-white rounded-xl p-6 shadow space-y-4">
    <h2 class="text-lg font-semibold text-gray-700">üìä –ö–∞–ª–æ—Ä–∏–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</h2>
    <canvas id="kcalChart" height="150"></canvas>
  </div>

  <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    <div class="bg-green-50 border border-green-200 p-4 rounded-xl shadow-sm">
      <div class="text-green-600 text-sm font-medium">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</div>
      <div class="text-xl font-bold">{{ week_total }} –∫–∫–∞–ª</div>
    </div>
    <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-xl shadow-sm">
      <div class="text-yellow-600 text-sm font-medium">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</div>
      <div class="text-xl font-bold">{{ month_total }} –∫–∫–∞–ª</div>
    </div>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –¥–∏–µ—Ç -->
  <div class="space-y-4">
    {% for d in diets %}
    <a href="/diet/{{ d.id }}" class="block bg-white p-4 rounded-xl shadow hover:shadow-lg transition">
      <div class="flex justify-between items-center">
        <div>
          <div class="font-semibold text-gray-800">üìÖ {{ d.date.strftime('%d.%m.%Y') }}</div>
          <div class="text-sm text-gray-500 mt-1">
            –ö–∞–ª–æ—Ä–∏–∏: <span class="font-medium text-gray-700">{{ d.total_kcal }}</span> |
            –ë: {{ d.protein }} –≥, –ñ: {{ d.fat }} –≥, –£: {{ d.carbs }} –≥
          </div>
        </div>
        <div class="text-blue-500 text-sm">–û—Ç–∫—Ä—ã—Ç—å ‚Üí</div>
      </div>
    </a>
    {% endfor %}
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('kcalChart').getContext('2d');
  const kcalChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ chart_labels|safe }},
      datasets: [{
        label: '–ö–∞–ª–æ—Ä–∏–∏ (–∫–∫–∞–ª)',
        data: {{ chart_values|safe }},
        backgroundColor: '#4ade80',
        borderRadius: 6
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 200
          }
        }
      }
    }
  });
</script>
{% endblock %}
